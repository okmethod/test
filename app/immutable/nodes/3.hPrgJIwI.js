import{s as I,e as g,a as v,c as p,b as M,x as P,f as _,g as y,h as x,i as S,j as m,n as b,p as W,D as E,u as R}from"../chunks/scheduler.8Jost-LZ.js";import{S as A,i as D}from"../chunks/index.Cv0tjidA.js";function H(){return Matter.Engine.create({enableSleeping:!0,positionIterations:6,velocityIterations:4,constraintIterations:6})}function V(){return Matter.Runner.create()}function C(r,t){return Matter.Render.create({element:t,engine:r,options:{width:t.clientWidth,height:t.clientHeight,pixelRatio:1,background:"transparent",hasBounds:!1,wireframes:!1,showSleeping:!1}})}function k(r,t){const a=Matter.Mouse.create(t.canvas);return t.mouse=a,Matter.MouseConstraint.create(r,{mouse:a,constraint:{stiffness:.2,damping:0,length:0,render:{visible:!1,lineWidth:2,strokeStyle:"#00ff00"}}})}async function B(r){const t=r.clientWidth,a=r.clientHeight;function e(n,c,i,s){return[{x:n/2-s,y:-i/2,w:n+s*2,h:i},{x:n/2-s,y:c+i/2,w:n+s*2,h:i},{x:-i/2,y:c/2-s,w:i,h:c+s*2},{x:n+i/2,y:c/2-s,w:i,h:c+s*2}]}return e(t,a,2e3,0).map(n=>Matter.Bodies.rectangle(n.x,n.y,n.w,n.h,{isStatic:!0,render:{visible:!1}}))}function j(r,t,a,e){function o(){e.isHolding=!0,Matter.World.add(r,t)}function n(){e.isHolding=!1,Matter.World.remove(r,t)}function c(){e.isHolding=!1,t.constraint.bodyA=null,t.constraint.bodyB=null,t.mouse.position={x:-1,y:-1},Matter.World.remove(r,t)}function i(s){const l=a.getBoundingClientRect();(s.clientX<l.left||s.clientX>l.right||s.clientY<l.top||s.clientY>l.bottom)&&Matter.World.remove(r,t)}return{pointerdown:o,pointerup:n,pointerleave:c,pointermove:i}}async function T(r,t){const a=await L(r),e=$(a),o=X(e,a.width,a.height),n=Y(o);return q(n,t)}async function L(r){return new Promise((t,a)=>{const e=new Image;e.crossOrigin="Anonymous",e.src=r,e.onload=()=>t(e),e.onerror=o=>a(o)})}function $(r){const{width:t,height:a}=r,e=document.createElement("canvas");e.width=t,e.height=a;const o=e.getContext("2d");if(!o)throw new Error("Canvas context could not be obtained");return o.drawImage(r,0,0,t,a),o.getImageData(0,0,t,a).data}function X(r,t,a){const e=[],o=new Set;function n(i,s){const l=(s*t+i)*4;return r[l+3]===0}function c(i,s){const l=`${i},${s}`;o.has(l)||(e.push({x:i,y:s}),o.add(l))}for(let i=0;i<a;i++)for(let s=0;s<t;s++)n(s,i)||((i===0||n(s,i-1))&&c(s,i),(i===a-1||n(s,i+1))&&c(s,i),(s===0||n(s-1,i))&&c(s,i),(s===t-1||n(s+1,i))&&c(s,i));return e}function Y(r){const t=r.reduce((e,o)=>(e.x+=o.x,e.y+=o.y,e),{x:0,y:0});t.x/=r.length,t.y/=r.length;const a=r.map(e=>{const o=Math.atan2(e.y-t.y,e.x-t.x);return{...e,angle:o}});return a.sort((e,o)=>e.angle-o.angle),a.map(e=>({x:e.x,y:e.y}))}function q(r,t){const a=r.reduce((o,n)=>o+n.x,0)/r.length,e=r.reduce((o,n)=>o+n.y,0)/r.length;return r.map(o=>({x:a+(o.x-a)*t,y:e+(o.y-e)*t}))}async function F(r,t,a){const e=await T(r,t*.9);return Matter.Bodies.fromVertices(a.x,a.y,[e],{restitution:.2,friction:.1,density:.001,render:{sprite:{texture:r,xScale:t,yScale:t}}})}function O(r){let t,a,e='<h1 class="cTitleStyle md:!text-3xl">ポケモン詰め放題</h1>',o,n,c,i="matter-js renderContainer",s,l;return{c(){t=g("div"),a=g("div"),a.innerHTML=e,o=v(),n=g("div"),c=g("span"),c.textContent=i,s=v(),l=g("div"),this.h()},l(d){t=p(d,"DIV",{class:!0});var u=M(t);a=p(u,"DIV",{class:!0,"data-svelte-h":!0}),P(a)!=="svelte-ggjt8b"&&(a.innerHTML=e),o=_(u),n=p(u,"DIV",{class:!0});var f=M(n);c=p(f,"SPAN",{"data-svelte-h":!0}),P(c)!=="svelte-tjtsqm"&&(c.textContent=i),s=_(f),l=p(f,"DIV",{class:!0}),M(l).forEach(y),f.forEach(y),u.forEach(y),this.h()},h(){x(a,"class","cTitlePartStyle md:!mb-4"),x(l,"class","w-80 h-80 bg-gray-300 border border-black"),x(n,"class","cContentPartStyle !m-4"),x(t,"class","cRouteBodyStyle")},m(d,u){S(d,t,u),m(t,a),m(t,o),m(t,n),m(n,c),m(n,s),m(n,l),r[1](l)},p:b,i:b,o:b,d(d){d&&y(t),r[1](null)}}}let N=!1;function U(r,t,a){const e=["https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/1.png","https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/4.png","https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/7.png"];let o,n,c,i,s;W(async()=>{n=H(),c=V(),i=C(n,o),s=k(n,i);const d=await B(o);{Matter.World.add(n.world,d),Matter.Runner.run(c,n),Matter.Render.run(i);const u=await Promise.all(e.map((w,h)=>F(w,1,{x:100+h*40,y:20+h*10})));Matter.World.add(n.world,u);let f=j(n.world,s,o,{isHolding:N});if(!f)return;Object.entries(f).forEach(([w,h])=>{o.addEventListener(w,h)})}}),E(()=>{{Matter.Render.stop(i),Matter.Runner.stop(c),Matter.World.clear(n.world,!1),Matter.Engine.clear(n);return}});function l(d){R[d?"unshift":"push"](()=>{o=d,a(0,o)})}return[o,l]}class J extends A{constructor(t){super(),D(this,t,U,O,I,{})}}export{J as component};
