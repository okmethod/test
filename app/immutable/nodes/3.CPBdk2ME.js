import{s as S,e as g,a as b,c as p,b as M,m as P,f as _,g as y,h as x,i as E,j as f,n as v,v as W,A,x as H}from"../chunks/scheduler.7YiWPMHY.js";import{S as R,i as V}from"../chunks/index.D5IxIBbb.js";function C(){return Matter.Engine.create({enableSleeping:!0,positionIterations:6,velocityIterations:4,constraintIterations:6})}function D(){return Matter.Runner.create()}function k(a,t){return Matter.Render.create({element:t,engine:a,options:{width:t.clientWidth,height:t.clientHeight,pixelRatio:1,background:"transparent",hasBounds:!1,wireframes:!1,showSleeping:!1}})}function B(a,t){const o=Matter.Mouse.create(t.canvas);return t.mouse=o,Matter.MouseConstraint.create(a,{mouse:o,constraint:{stiffness:.2,damping:0,length:0,render:{visible:!1,lineWidth:2,strokeStyle:"#00ff00"}}})}async function j(a){const t=a.clientWidth,o=a.clientHeight;function e(n,c,i,s){return[{x:n/2-s,y:-i/2,w:n+s*2,h:i},{x:n/2-s,y:c+i/2,w:n+s*2,h:i},{x:-i/2,y:c/2-s,w:i,h:c+s*2},{x:n+i/2,y:c/2-s,w:i,h:c+s*2}]}return e(t,o,2e3,0).map(n=>Matter.Bodies.rectangle(n.x,n.y,n.w,n.h,{isStatic:!0,render:{visible:!1}}))}function L(a,t,o,e){function r(){e.isHolding=!0,Matter.World.add(a,t)}function n(){e.isHolding=!1,Matter.World.remove(a,t)}function c(){e.isHolding=!1,t.constraint.bodyA=null,t.constraint.bodyB=null,t.mouse.position={x:-1,y:-1},Matter.World.remove(a,t)}function i(s){const l=o.getBoundingClientRect();(s.clientX<l.left||s.clientX>l.right||s.clientY<l.top||s.clientY>l.bottom)&&Matter.World.remove(a,t)}return{pointerdown:r,pointerup:n,pointerleave:c,pointermove:i}}async function T(a,t){const o=await $(a),e=O(o),r=X(e,o.width,o.height),n=Y(r);return q(n,t)}async function $(a){return new Promise((t,o)=>{const e=new Image;e.crossOrigin="Anonymous",e.src=a,e.onload=()=>t(e),e.onerror=r=>o(r)})}function O(a){const{width:t,height:o}=a,e=document.createElement("canvas");e.width=t,e.height=o;const r=e.getContext("2d");if(!r)throw new Error("Canvas context could not be obtained");return r.drawImage(a,0,0,t,o),r.getImageData(0,0,t,o).data}function X(a,t,o){const e=[],r=new Set;function n(i,s){const l=(s*t+i)*4;return a[l+3]===0}function c(i,s){const l=`${i},${s}`;r.has(l)||(e.push({x:i,y:s}),r.add(l))}for(let i=0;i<o;i++)for(let s=0;s<t;s++)n(s,i)||((i===0||n(s,i-1))&&c(s,i),(i===o-1||n(s,i+1))&&c(s,i),(s===0||n(s-1,i))&&c(s,i),(s===t-1||n(s+1,i))&&c(s,i));return e}function Y(a){const t=a.reduce((e,r)=>(e.x+=r.x,e.y+=r.y,e),{x:0,y:0});t.x/=a.length,t.y/=a.length;const o=a.map(e=>{const r=Math.atan2(e.y-t.y,e.x-t.x);return{...e,angle:r}});return o.sort((e,r)=>e.angle-r.angle),o.map(e=>({x:e.x,y:e.y}))}function q(a,t){const o=a.reduce((r,n)=>r+n.x,0)/a.length,e=a.reduce((r,n)=>r+n.y,0)/a.length;return a.map(r=>({x:o+(r.x-o)*t,y:e+(r.y-e)*t}))}async function F(a,t,o){const e=await T(a,t*.9);return Matter.Bodies.fromVertices(o.x,o.y,[e],{restitution:.2,friction:.1,density:.001,render:{sprite:{texture:a,xScale:t,yScale:t}}})}function z(a){let t,o,e='<h1 class="cTitleStyle md:!text-3xl">Example route</h1>',r,n,c,i="matter-js renderContainer",s,l;return{c(){t=g("div"),o=g("div"),o.innerHTML=e,r=b(),n=g("div"),c=g("span"),c.textContent=i,s=b(),l=g("div"),this.h()},l(m){t=p(m,"DIV",{class:!0});var d=M(t);o=p(d,"DIV",{class:!0,"data-svelte-h":!0}),P(o)!=="svelte-11znixk"&&(o.innerHTML=e),r=_(d),n=p(d,"DIV",{class:!0});var u=M(n);c=p(u,"SPAN",{"data-svelte-h":!0}),P(c)!=="svelte-tjtsqm"&&(c.textContent=i),s=_(u),l=p(u,"DIV",{class:!0}),M(l).forEach(y),u.forEach(y),d.forEach(y),this.h()},h(){x(o,"class","cTitlePartStyle md:!mb-4"),x(l,"class","w-80 h-80 bg-gray-300 border border-black"),x(n,"class","cContentPartStyle !ml-4"),x(t,"class","cRouteBodyStyle")},m(m,d){E(m,t,d),f(t,o),f(t,r),f(t,n),f(n,c),f(n,s),f(n,l),a[1](l)},p:v,i:v,o:v,d(m){m&&y(t),a[1](null)}}}let N=!1;function U(a,t,o){const e=["https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/1.png","https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/4.png","https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/7.png"];let r,n,c,i,s,l;W(async()=>{n=C(),c=D(),i=k(n,r),s=B(n,i);const d=await j(r);{Matter.World.add(n.world,d),Matter.Runner.run(c,n),Matter.Render.run(i);const u=await Promise.all(e.map((w,h)=>F(w,1,{x:100+h*40,y:20+h*10})));Matter.World.add(n.world,u);let I=L(n.world,s,r,{isHolding:N});Object.entries(I).forEach(([w,h])=>{r.addEventListener(w,h)})}}),A(()=>{Matter.Render.stop(i),Matter.Runner.stop(c),Matter.World.clear(n.world,!1),Matter.Engine.clear(n),Object.entries(l).forEach(([d,u])=>{r.removeEventListener(d,u)})});function m(d){H[d?"unshift":"push"](()=>{r=d,o(0,r)})}return[r,m]}class K extends R{constructor(t){super(),V(this,t,U,z,S,{})}}export{K as component};
